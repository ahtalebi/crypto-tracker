<div class="dashboard-container">
  
  <!-- Modern Header with Auto-Refresh -->
  <header class="modern-header">
    <div class="header-content">
      <div class="header-left">
        <mat-icon class="header-icon">currency_bitcoin</mat-icon>
        <div>
          <h1>Crypto Tracker</h1>
          <p>Real-time cryptocurrency market data</p>
        </div>
      </div>
      <div class="header-right">
        <div class="refresh-status">
          <span class="last-updated">Last updated: {{ lastUpdated | date:'short' }}</span>
          <button mat-icon-button (click)="manualRefresh()" matTooltip="Refresh now">
            <mat-icon>refresh</mat-icon>
          </button>
          <button mat-icon-button (click)="toggleAutoRefresh()" 
                  [matTooltip]="autoRefreshEnabled ? 'Disable auto-refresh' : 'Enable auto-refresh'">
            <mat-icon [class.active]="autoRefreshEnabled">autorenew</mat-icon>
          </button>
          <span class="countdown" *ngIf="autoRefreshEnabled">{{ refreshCountdown }}s</span>
        </div>
      </div>
    </div>
  </header>

  <div *ngIf="loading" class="loading-spinner">
    <mat-icon class="spin">autorenew</mat-icon>
    <p>Loading cryptocurrency data...</p>
  </div>

  <div *ngIf="!loading" class="main-content">
    
    <!-- Stats Cards -->
    <div class="stats-section">
      <mat-card class="stat-card gradient-purple">
        <mat-card-content>
          <mat-icon>account_balance</mat-icon>
          <div class="stat-info">
            <div class="stat-value">{{ formatNumber(totalMarketCap) }}</div>
            <div class="stat-label">Total Market Cap</div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card gradient-green" *ngIf="biggestGainer">
        <mat-card-content>
          <mat-icon>trending_up</mat-icon>
          <div class="stat-info">
            <div class="stat-value">+{{ biggestGainer.price_change_percentage_24h.toFixed(2) }}%</div>
            <div class="stat-label">{{ biggestGainer.name }}</div>
            <div class="stat-sublabel">Biggest Gainer</div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card gradient-red" *ngIf="biggestLoser">
        <mat-card-content>
          <mat-icon>trending_down</mat-icon>
          <div class="stat-info">
            <div class="stat-value">{{ biggestLoser.price_change_percentage_24h.toFixed(2) }}%</div>
            <div class="stat-label">{{ biggestLoser.name }}</div>
            <div class="stat-sublabel">Biggest Loser</div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card gradient-blue">
        <mat-card-content>
          <mat-icon>data_usage</mat-icon>
          <div class="stat-info">
            <div class="stat-value">{{ filteredData.length }}</div>
            <div class="stat-label">Cryptocurrencies</div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Filters -->
    <mat-card class="filters-card">
      <mat-card-content>
        <div class="filters-container">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search</mat-label>
            <input matInput [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()" 
                   placeholder="Bitcoin, ETH, Cardano...">
            <mat-icon matPrefix>search</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Sort By</mat-label>
            <mat-select [(ngModel)]="sortBy" (ngModelChange)="applyFilters()">
              <mat-option value="marketcap">
                <mat-icon>account_balance_wallet</mat-icon> Market Cap
              </mat-option>
              <mat-option value="price">
                <mat-icon>euro</mat-icon> Price
              </mat-option>
              <mat-option value="change24h">
                <mat-icon>show_chart</mat-icon> 24h Change
              </mat-option>
              <mat-option value="volume">
                <mat-icon>swap_vert</mat-icon> Volume
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Show</mat-label>
            <mat-select [(ngModel)]="showCount" (ngModelChange)="applyFilters()">
              <mat-option [value]="10">Top 10</mat-option>
              <mat-option [value]="25">Top 25</mat-option>
              <mat-option [value]="50">Top 50</mat-option>
              <mat-option [value]="100">Top 100</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Tabs for Overview, Charts, and Full Table -->
    <mat-tab-group (selectedIndexChange)="onTabChange($event)" 
                   animationDuration="300ms"
                   class="main-tabs">
      
      <!-- Tab 1: Overview -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">dashboard</mat-icon>
          Overview
        </ng-template>
        
        <div class="tab-content">
          <!-- Crypto Cards Grid -->
          <div class="crypto-grid-modern">
            <mat-card class="crypto-card-modern" *ngFor="let crypto of filteredData.slice(0, 12)">
              <div class="card-header">
                <img [src]="crypto.image" [alt]="crypto.name" class="crypto-logo-large">
                <div class="crypto-info">
                  <h3>{{ crypto.name }}</h3>
                  <span class="crypto-symbol">{{ crypto.symbol.toUpperCase() }}</span>
                </div>
                <div class="rank-badge">
                  <span>#{{ crypto.market_cap_rank }}</span>
                </div>
              </div>
              
              <div class="card-body">
                <div class="price-section">
                  <div class="current-price">{{ formatNumber(crypto.current_price) }}</div>
                  <div class="price-change" [ngClass]="getChangeClass(crypto.price_change_percentage_24h)">
                    <mat-icon>{{ crypto.price_change_percentage_24h >= 0 ? 'arrow_drop_up' : 'arrow_drop_down' }}</mat-icon>
                    {{ Math.abs(crypto.price_change_percentage_24h).toFixed(2) }}%
                  </div>
                </div>
                
                <div class="card-details">
                  <div class="detail-item">
                    <span class="detail-label">Market Cap</span>
                    <span class="detail-value">{{ formatNumber(crypto.market_cap) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Volume 24h</span>
                    <span class="detail-value">{{ formatNumber(crypto.total_volume) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">High 24h</span>
                    <span class="detail-value">{{ formatNumber(crypto.high_24h) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Low 24h</span>
                    <span class="detail-value">{{ formatNumber(crypto.low_24h) }}</span>
                  </div>
                </div>
              </div>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <!-- Tab 2: Charts & Analytics -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">bar_chart</mat-icon>
          Charts & Analytics
        </ng-template>
        
        <div class="tab-content">
          <div class="charts-grid">
            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>show_chart</mat-icon>
                  Price Comparison
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <canvas id="priceChart"></canvas>
              </mat-card-content>
            </mat-card>

            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>pie_chart</mat-icon>
                  Market Dominance
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <canvas id="marketCapChart"></canvas>
              </mat-card-content>
            </mat-card>

            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>trending_up</mat-icon>
                  24h Performance
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <canvas id="changeChart"></canvas>
              </mat-card-content>
            </mat-card>

            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>swap_vert</mat-icon>
                  Trading Volume
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <canvas id="volumeChart"></canvas>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <!-- Tab 3: All Cryptocurrencies Table -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">table_chart</mat-icon>
          All Cryptocurrencies
          <span class="tab-badge">{{ filteredData.length }}</span>
        </ng-template>
        
        <div class="tab-content">
          <mat-card class="table-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>table_chart</mat-icon>
                Complete Market Data
              </mat-card-title>
              <mat-card-subtitle>
                Showing {{ filteredData.length }} cryptocurrencies | 
                Total Market Cap: {{ formatNumber(totalMarketCap) }}
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Coin</th>
                      <th>Price</th>
                      <th>24h %</th>
                      <th>7d %</th>
                      <th>Market Cap</th>
                      <th>Volume (24h)</th>
                      <th>Circulating Supply</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let crypto of filteredData" class="table-row">
                      <td class="rank-cell">{{ crypto.market_cap_rank }}</td>
                      <td class="coin-cell">
                        <img [src]="crypto.image" [alt]="crypto.name">
                        <div class="coin-name-wrapper">
                          <span class="coin-name">{{ crypto.name }}</span>
                          <span class="coin-symbol">{{ crypto.symbol.toUpperCase() }}</span>
                        </div>
                      </td>
                      <td class="price-cell">{{ formatNumber(crypto.current_price) }}</td>
                      <td [ngClass]="getChangeClass(crypto.price_change_percentage_24h)" class="change-cell">
                        <mat-icon class="change-icon">
                          {{ crypto.price_change_percentage_24h >= 0 ? 'arrow_drop_up' : 'arrow_drop_down' }}
                        </mat-icon>
                        {{ crypto.price_change_percentage_24h.toFixed(2) }}%
                      </td>
                      <td [ngClass]="getChangeClass(crypto.price_change_percentage_7d || 0)" class="change-cell">
                        <mat-icon class="change-icon">
                          {{ (crypto.price_change_percentage_7d || 0) >= 0 ? 'arrow_drop_up' : 'arrow_drop_down' }}
                        </mat-icon>
                        {{ (crypto.price_change_percentage_7d || 0).toFixed(2) }}%
                      </td>
                      <td>{{ formatNumber(crypto.market_cap) }}</td>
                      <td>{{ formatNumber(crypto.total_volume) }}</td>
                      <td class="supply-cell">
                        {{ formatNumber(crypto.circulating_supply) }}
                        <span class="supply-symbol">{{ crypto.symbol.toUpperCase() }}</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

    </mat-tab-group>

  </div>
</div>
